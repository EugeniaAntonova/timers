<section data-request-id="13" class="section game sevens"
    style="--game-color: rgb(78 157 38); --background: url('https://static.sz.kz/landings/visualizer/777.svg')"
    id="thsev">
    <img src="<#SelfURL>/picture?file=108" alt="777" class="game-logo">
    <div class="section-content">
        <h2 class="visually-hidden">
            777
        </h2>
        <div class="timer js-ths" data-timer="true" data-postfix="777">
            <div class="timer__title">
                Тиражға дейін:
            </div>
            <div class="timer__body timer__body_desk-slider">
                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider days-777">00</span>
                    <span class="timer__label timer__label_desk-slider">к.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider hours-777">00</span>
                    <span class="timer__label timer__label_desk-slider">с.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider minutes-777">00</span>
                    <span class="timer__label timer__label_desk-slider">м.</span>
                </div>
            </div>
        </div>
        <div class="actions">
            <a href="/gamedemo?gameid=1081" class="action part">Қатысу</a>
            <a href="/resultsGame?gAlias=bet_sz_777" class="action archive">Мұрағат</a>
        </div>
        <div class="result">
            <h3 class="result-title">
                Нәтиже:
            </h3>
            <div class="result-string js-result await">
                <div class="loader-element">
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                </div>
            </div>
        </div>
    </div>
</section>
<section data-request-id="1" class="section game 820"
    style="--game-color: #810baa; --background: url('https://static.sz.kz/landings/visualizer/820.svg')" id="eghtw">
    <img src="<#SelfURL>/picture?file=436" alt="8/20" class="game-logo">
    <div class="section-content">
        <h2 class="visually-hidden">
            8/20
        </h2>
        <div class="timer js-eghtw" data-timer="true" data-postfix="820">
            <div class="timer__title">
                Тиражға дейін:
            </div>
            <div class="timer__body timer__body_desk-slider">
                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider days-820">00</span>
                    <span class="timer__label timer__label_desk-slider">к.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider hours-820">00</span>
                    <span class="timer__label timer__label_desk-slider">с.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider minutes-820">00</span>
                    <span class="timer__label timer__label_desk-slider">м.</span>
                </div>
            </div>
        </div>
        <div class="actions">
            <a href="/gamedemo?gameid=1041" class="action part">Қатысу</a>
            <a href="/resultsGame?gAlias=bet_sz_820" class="action archive">Мұрағат</a>
        </div>
        <div class="result">
            <h3 class="result-title">
                Нәтиже:
            </h3>
            <div class="result-string js-result await">
                <div class="loader-element">
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                </div>
            </div>
        </div>
    </div>
</section>
<section data-request-id="2" class="section game 420"
    style="--game-color: #dd5014; --background: url('https://static.sz.kz/landings/visualizer/420.svg')" id="ftw">
    <img src="<#SelfURL>/picture?file=402" alt="4/20" class="game-logo">
    <div class="section-content">
        <h2 class="visually-hidden">
            4/20
        </h2>
        <div class="timer js-ftw2" data-timer="true" data-postfix="420">
            <div class="timer__title">
                Тиражға дейін:
            </div>
            <div class="timer__body timer__body_desk-slider">
                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider days-420">00</span>
                    <span class="timer__label timer__label_desk-slider">к.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider hours-420">00</span>
                    <span class="timer__label timer__label_desk-slider">с.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider minutes-420">00</span>
                    <span class="timer__label timer__label_desk-slider">м.</span>
                </div>
            </div>
        </div>
        <div class="actions">
            <a href="/gamedemo?gameid=1042" class="action part">Қатысу</a>
            <a href="/resultsGame?gAlias=bet_sz_420" class="action archive">Мұрағат</a>
        </div>
        <div class="result">
            <h3 class="result-title">
                Нәтиже:
            </h3>
            <div class="result-string js-result await">
                <div class="loader-element">
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                </div>
            </div>
        </div>
    </div>
</section>
<section data-request-id="4" class="section game sl"
    style="--game-color: #bd1566; --background: url('https://static.sz.kz/landings/visualizer/sl.svg')" id="sl">
    <img src="<#SelfURL>/picture?file=630" alt="SuperLoto" class="game-logo">
    <div class="section-content">
        <h2 class="visually-hidden">
            SuperLoto
        </h2>
        <div class="timer js-sl" data-timer="true" data-postfix="sl">
            <div class="timer__title">
                Тиражға дейін:
            </div>
            <div class="timer__body timer__body_desk-slider">
                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider days-sl">00</span>
                    <span class="timer__label timer__label_desk-slider">к.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider hours-sl">00</span>
                    <span class="timer__label timer__label_desk-slider">с.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider minutes-sl">00</span>
                    <span class="timer__label timer__label_desk-slider">м.</span>
                </div>
            </div>
        </div>
        <div class="actions">
            <a href="/gamedemo?gameid=1043" class="action part">Қатысу</a>
            <a href="/resultsGame?gAlias=bet_sz_550" class="action archive">Мұрағат</a>
        </div>
        <div class="result">
            <h3 class="result-title">
                Нәтиже:
            </h3>
            <div class="result-string js-result await">
                <div class="loader-element">
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                </div>
            </div>
        </div>
    </div>
</section>
<section data-request-id="14" class="section game keno2"
    style="--game-color: #004f89; --background: url('https://static.sz.kz/landings/visualizer/keno2.svg')" id="keno2">
    <img src="<#SelfURL>/picture?file=631" alt="Keno" class="game-logo">
    <div class="section-content">
        <h2 class="visually-hidden">
            Keno2
        </h2>
        <div class="timer js-keno2" data-timer="true" data-postfix="keno2">
            <div class="timer__title">
                Тиражға дейін:
            </div>
            <div class="timer__body timer__body_desk-slider">
                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider days-keno2">00</span>
                    <span class="timer__label timer__label_desk-slider">к.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider hours-keno2">00</span>
                    <span class="timer__label timer__label_desk-slider">с.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider minutes-keno2">00</span>
                    <span class="timer__label timer__label_desk-slider">м.</span>
                </div>
            </div>
        </div>
        <div class="actions">
            <a href="/gamedemo?gameid=1083" class="action part">Қатысу</a>
            <a href="/resultsGame?gAlias=bet_sz_keno2" class="action archive">Мұрағат</a>
        </div>
        <div class="result">
            <h3 class="result-title">
                Нәтиже:
            </h3>
            <div class="result-string js-result await">
                <div class="loader-element">
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                </div>
            </div>
        </div>
    </div>
</section>
<section data-request-id="12" class="section game keno"
    style="--game-color: #5199f1; --background: url('https://static.sz.kz/landings/visualizer/keno.svg')" id="keno">
    <img src="<#SelfURL>/picture?file=109" alt="Keno" class="game-logo">
    <div class="section-content">
        <h2 class="visually-hidden">
            Keno
        </h2>
        <div class="timer js-keno" data-timer="true" data-postfix="keno">
            <div class="timer__title">
                Тиражға дейін:
            </div>
            <div class="timer__body timer__body_desk-slider">
                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider days-keno">00</span>
                    <span class="timer__label timer__label_desk-slider">к.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider hours-keno">00</span>
                    <span class="timer__label timer__label_desk-slider">с.</span>
                </div>

                <div class="timer__section">
                    <span class="timer__item timer__item timer__item_desk-slider minutes-keno">00</span>
                    <span class="timer__label timer__label_desk-slider">м.</span>
                </div>
            </div>
        </div>
        <div class="actions">
            <a href="/gamedemo?gameid=1080" class="action part">Қатысу</a>
            <a href="/resultsGame?gAlias=bet_sz_keno" class="action archive">Мұрағат</a>
        </div>
        <div class="result">
            <h3 class="result-title">
                Нәтиже:
            </h3>
            <div class="result-string js-result await">
                <div class="loader-element">
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                    <span class="loader-item">?</span>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    let times = ["10:00", "14:30", "19:00", "20:00", "22:00"];
    // 777 = thsev, 420 = ftw, 820 = eghtw, super loto = sl
    let config = {
        "10:00": [
            {
                gameId: 14,
                drawNumber: 3448,
                sectionId: "thsev"
            }
        ],
        "14:30": [
            {
                gameId: 13,
                drawNumber: 1753,
                sectionId: "keno2"
            }
        ],
        "19:00": [
            {
                gameId: 1,
                drawNumber: 682,
                sectionId: "eghtw",
            },
            {
                gameId: 4,
                drawNumber: 671,
                sectionId: "sl",
                fields: 2,
                field1: 5,
            }
        ],
        "20:00": [
            {
                gameId: 2,
                drawNumber: 1035,
                sectionId: "ftw",
                fields: 2,
                field1: 4,
            }
        ],
        "22:00": [
            {
                gameId: 12,
                drawNumber: 2506,
                sectionId: "keno",
            },
            {
                gameId: 14,
                drawNumber: 3447,
                sectionId: "thsev"
            }
        ]
    };

    function checkTime() {
        let now = new Date();
        let currentTime = `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
        console.log(currentTime);
        if (times.includes(currentTime)) {
            config[currentTime].forEach((item) => { new DataUpdater(item) })
        }
    }
    document.addEventListener('DOMContentLoaded', () => {
        checkTime();
        setInterval(checkTime, 60000);
    })

    class DataUpdater {
        constructor(config) {
            this.animationDelay = .5;
            this.base =
                "https://module.sz.kz/drawwinnumbers?game_id=_&draw_number=_";
            this.init(config);
        }

        init(config) {
            let { gameId, drawNumber, sectionId } = config;

            if (config.hasOwnProperty('fields')) {
                this.fields = config['fields'];
                this.field1 = config['field1'];
            }

            this.link = this.base
                .replace(/(?<=game_id=)_/, gameId)
                .replace(/(?<=draw_number=)_/, drawNumber);

            this.resultParent = document.querySelector(`#${sectionId} .js-result`);
            this.getData(this.link, this.onSuccess.bind(this), this.onError.bind(this));
        }

        messages = {
            fail: "Деректерді ала-алмадық"
        };

        onSuccess(data) {
            let numbers = data['winNumberArray'];

            let commonFragment = document.createDocumentFragment();
            let field = document.createElement('div');
            field.classList.add('field');

            numbers.forEach((number, index) => {
                if (this.field1 && index == this.field1) {
                    field.insertAdjacentHTML('afterbegin', '<h3 class="field-title">Поле 1</h3>')
                    commonFragment.append(field);
                    field = document.createElement('div');
                    field.classList.add('field');
                    field.insertAdjacentHTML('afterbegin', '<h3 class="field-title">Поле 2</h3>')
                }

                let item = document.createElement('span');
                item.classList.add('result-item');
                item.textContent = number;
                item.style.setProperty('--del', `${index * this.animationDelay}s`);
                field.append(item);
            })
            commonFragment.append(field);
            this.resultParent.classList.remove('await');
            this.resultParent.append(commonFragment);
        }

        onError(error) {
            this.resultParent.classList.remove("await");
            this.resultParent.innerHTML = `<p class="result-error">${error}</p>`;
        }

        async getData(link, onSuccess, onFail) {
            try {
                const response = await fetch(link);

                if (!response.ok) {
                    throw new Error(this.messages.fail);
                }
                onSuccess(await response.json());
            } catch (error) {
                onFail(this.messages.fail);
                console.log(error);
            }
        }
    }
</script>